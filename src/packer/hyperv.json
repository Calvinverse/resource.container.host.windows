{
    "variables": {
        "host_ip": null,

        "vm_import_directory": null,
        "vm_name": "containerhost-windows2016",
        "vm_switch_name": "internal_switch",

        "admin_username": "admin",
        "admin_password": "admin",

        "dir_cookbooks_src": "src/cookbooks",
        "dir_cookbooks_vendors": "packages/vendor/cookbooks",
        "dir_deploy": null,
        "dir_http_user": null,
        "dir_temp": null,
        "dir_vm_import": null
    },
    "builders": [
        {
            "boot_wait": "5s",
            "boot_command": [],
            "clone_from_vmxc_path": "{{ user `dir_vm_import` }}",
            "communicator": "winrm",
            "generation": 2,
            "guest_additions_mode": "disable",
            "http_directory": "{{ user `dir_http_user` }}",
            "output_directory": "{{ user `dir_temp` }}/{{ user `vm_name` }}",
            "ram_size": 2048,
            "secondary_iso_images": [
                "{{ user `dir_deploy` }}/sysprep.iso"
            ],
            "shutdown_command": "IF EXIST a:\\run-sysprep.cmd (CALL a:\\run-sysprep.cmd) ELSE (IF EXIST e:\\run-sysprep.cmd (CALL e:\\run-sysprep.cmd) ELSE (CALL f:\\run-sysprep.cmd)) &IF \"%ERRORLEVEL%\" == \"0\" (ECHO \"Shutdown script succeeded with exit code = %ERRORLEVEL%\" &EXIT 0) ELSE (ECHO \"Shutdown script failed with exit code = %ERRORLEVEL%\" &EXIT %ERRORLEVEL%)",
            "shutdown_timeout": "5m",
            "switch_name": "{{user `vm_switch_name`}}",
            "type": "hyperv-vmcx",
            "vm_name": "{{ user `vm_name` }}",
            "winrm_password": "{{ user `admin_password` }}",
            "winrm_timeout": "2h",
            "winrm_username": "{{ user `admin_username` }}"
        }
    ],
    "provisioners": [
        {
            "inline": "$item = Get-ChildItem -Path d: -Filter *.msi | Select-Object -First 1; Copy-Item $item.FullName c:/Windows/Temp/chef.msi",
            "type": "powershell"
        },
        {
            "elevated_password": "{{ user `admin_password` }}",
            "elevated_user": "{{ user `admin_username` }}",
            "inline": "powershell.exe -Command \"Start-Process 'msiexec' -ArgumentList '/qb /i C:\\Windows\\Temp\\chef.msi' -NoNewWindow -Wait\"",
            "type": "powershell"
        },
        {
            "cookbook_paths": [
                "{{ user `dir_cookbooks_vendors` }}"
            ],
            "execute_command": "c:/opscode/chef/bin/chef-solo.bat --no-color -c {{.ConfigPath}} -j {{.JsonPath}}",
            "guest_os_type": "windows",
            "install_command": "echo do nothing",
            "run_list": [
                "resource_container_host_windows::default"
            ],
            "type": "chef-solo"
        },
        {
            "type": "powershell",
            "inline": "powershell.exe -Command \"Start-Process 'msiexec' -ArgumentList '/qb /x C:\\Windows\\Temp\\chef.msi' -NoNewWindow -Wait\""
        }
    ]
}
